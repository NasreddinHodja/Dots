# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

A Doom Emacs configuration (`~/.config/doom/`) for a Linux (Arch) system. The user goes by "nasreddin" / tomás bizet.

## Key Commands

```bash
# Reload Doom after changing init.el or packages.el
doom sync

# Rebuild all packages (after Emacs or package updates)
doom build

# Check for config issues
doom doctor

# Install missing packages
doom sync -u
```

After editing `config.el` only, a simple `SPC h r r` (doom/reload) inside Emacs is sufficient — no `doom sync` needed.

## File Roles

- **init.el** — Declares which Doom modules are active. Changing this requires `doom sync`.
- **config.el** — All runtime configuration: theme, keybindings, custom functions, hooks. This is where most edits happen.
- **packages.el** — Declares extra packages beyond what Doom modules provide. Changing this requires `doom sync`.
- **custom.el** — Auto-generated by `M-x customize`. Do not hand-edit.
- **local/kanata-kbd-mode.el** — Custom major mode for Kanata keyboard config files (`.kbd`).

## Architecture & Conventions

**Naming:** Custom functions and variables use the `nas/` prefix (e.g., `nas/restart`, `nas/find-in-dir`).

**Doom idioms used throughout config.el:**
- `after!` for post-load config, `map!` for keybindings, `add-hook!` for hooks, `setq!` for theme-aware setters.
- All files use `lexical-binding: t`.

**Config sections in config.el** (in order): GENERAL, ORG-MODE, ESHELL, VTERM, CLAUDEMACS, KANATA, MAPS.

**Org-mode** is the most heavily customized area — custom TODO keywords, Org-Roam with slug-based filenames, LaTeX preview via pdflatex+ImageMagick, Hugo blogging integration, custom font-lock for `!!!` and `???` markers.

**Eshell aliases** are auto-generated from `~/.config/aliasrc` via `nas/eshell-convert-aliasrc` on eshell-mode entry. Don't edit `eshell/aliases` directly.

**Kanata integration:** Saving a `.kbd` file auto-copies it to `/etc/kanata/kanata-config.kbd` via TRAMP sudo.

**LSP languages:** C/C++, Python (Pyright+pyenv), JavaScript, Rust, Web, Typst (tinymist).

## Custom Keybinding Map

Key custom bindings to be aware of when editing maps:
- `SPC f i` — Directory quick-access (d=Dots, b=bin, p=Prog, f=Facu, w=Work, h=Home)
- `SPC c RET` — Format buffer (remapped from `SPC c f`)
- `M-p` prefix — Popup management (raise/close/toggle/cycle)
- `SPC q r` — Restart Emacs daemon via systemd
- `SPC M-c` — Claude Code menu (claudemacs)

## Extra Packages (packages.el)

claudemacs, eat (terminal), perfect-margin, yuck-mode, typst-ts-mode. All pinned to specific repos — check packages.el for source URLs before updating.
