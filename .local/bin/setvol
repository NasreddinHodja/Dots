#!/usr/bin/env sh

case "$1" in
  up)   wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+ ;;
  down) wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%- ;;
  mute) wpctl set-mute   @DEFAULT_AUDIO_SINK@ toggle ;;
esac

raw=$(wpctl get-volume @DEFAULT_AUDIO_SINK@)

if echo "$raw" | grep -q "\[MUTED\]"; then
  vol="[MUTED]"
  hint_val=0
else
  vol=$(echo "$raw" | awk '{printf "%.0f%", $2*100}')
  hint_val=$vol
fi

notify-send \
  -u low \
  -h int:value:"$hint_val" \
  -h string:x-canonical-private-synchronous:volume \
  "Volume" "$vol"
